# Distributing Nine Morris 3D

## Requirements

- NSIS (packaging - Windows only)

## Linux

- Build the binaries as per `BUILD.md`
- Export the assets

```txt
cd scripts
./export_assets.py ../build_dist/ ../assets/ ../assets_engine/
```

- Build the archive

```txt
cd scripts
./create_source_archive.sh ../build_dist/ X.Y.Z ../build_dist/nine_morris_3d/nine_morris_3d ../ \
    ../build_dist/assets/icons/ ../distribution/nine_morris_3d/linux/nine_morris_3d.desktop \
    ../build_dist/assets/ ../build_dist/assets_engine/
```

- Create a new directory called `Nine-Morris-3D-X.Y.Z-Linux`
- Copy the archive from `build_dist/` into the directory
- Copy `README.txt` from `distribution/nine_morris_3d/` into the directory
- Copy `install.sh` and `uninstall.sh` from `distribution/nine_morris_3d/linux/` into the directory
- Archive the directory

```txt
tar -czf Nine-Morris-3D-X.Y.Z-Linux.tar.gz Nine-Morris-3D-X.Y.Z-Linux
```

## Windows

- Build the binaries as per `BUILD.md`
- Export the assets

```txt
cd scripts
python export_assets.py ..\build ..\assets ..\assets_engine
```

- Create a new folder called whatever
- Copy `nine_morris_3d.exe` from `build\nine_morris_3d\Release` into the folder
- Copy the engine binaries from root into the folder
- Copy the assets directories from `build` into the folder
- Copy `README.txt` from `distribution\nine_morris_3d` into the folder
- Copy `nine_morris_3d.nsi` from `distribution\nine_morris_3d\windows` into the folder
- Copy `nine_morris_3d.ico` from `nine_morris_3d\res` into the folder
- Create an NSIS installer called `Nine-Morris-3D-X.Y.Z-Windows` using the installer script

## Server (Linux)

- Build the binaries as per `BUILD.md`
- Create a new directory called `Nine-Morris-3D-Server-X.Y.Z-Linux`
- Copy `nine_morris_3d_server` from `build_dist/nine_morris_3d_server/` into the directory
- Copy `README.txt` from `distribution/nine_morris_3d_server/` into the directory
- Copy `install.sh`, `uninstall.sh` and `nine_morris_3d_server.service` from
  `distribution/nine_morris_3d_server/linux/` into the directory
- Archive the directory

```txt
tar -czf Nine-Morris-3D-Server-X.Y.Z-Linux.tar.gz Nine-Morris-3D-Server-X.Y.Z-Linux
```

## Update The Version

- version.hpp
- ninemorris3d.desktop
- nine_morris_3d.nsi

## Caveats

Both the scripts on Linux and the installer on Windows install the game system-wide. Any data generated by the game
(settings, saved data, logs) is not erased upon uninstallation, as it's written into the users' directories.

Currently, server as a service is only supported on Linux with `systemd`. Upon server uninstallation, the configuration
and log files are not deleted by default (opt in). The server should be distributed separately, into its own archive.
In distribution mode, the server should be started by `systemd`, not directly from the command line.
